> âš ï¸ æœ¬é¡¹ç›®ä¸º [lmobest](https://lmo.best) çš„å¼€æºç‰ˆæœ¬ï¼Œç›®å‰å¹¶æ²¡æœ‰å‘å¸ƒæ­£å¼ç‰ˆ
>
> ç”¨æˆ·å±‚çš„é€»è¾‘å·²ç»å®ç°å®Œæ¯•ï¼Œç®¡ç†é¡µé¢ï¼ˆåå°ï¼‰ä»åœ¨å¼€å‘ä¸­ã€‚
> 
> å¯ä»¥å…³æ³¨[é¢‘é“](https://t.me/s/ChatGPTAdminWebChannel)è·å–æœ€æ–°æ¶ˆæ¯ã€‚

<div align="center">

<img src="apps/docs/static/img/icon.svg" alt="icon"/>

<h1 align="center">ChatGPT Admin Web</h1>

ç®€ä½“ä¸­æ–‡ / [English](./README_EN.md)

[apps/chat](./apps/chat/README.md)
åŸºäº [ChatGPT-Next-Web](https://github.com/Yidadaa/ChatGPT-Next-Web/tree/b1f27aaf93c88c088db6bae5ac8163e2ffe991bd)
äºŒæ¬¡å¼€å‘

å¸¦æœ‰ç”¨æˆ·ç®¡ç†å’Œåå°é¢æ¿çš„ ChatGPT ç½‘é¡µåº”ç”¨

<table>
    <tbody>
      <tr>
        <td>
          <a href="https://docs.lmo.best/">ğŸ“š éƒ¨ç½²æ–‡æ¡£</a>
        </td>
        <td>
          <a href="https://lmo.best/">ğŸ¦ æ¼”ç¤ºç«™ç‚¹</a>
        </td>
        <td>
          <a href="https://github.com/AprilNEA/ChatGPT-April-Web/issues">ğŸ’¬ åé¦ˆ</a>
        </td>
        <td>
          ğŸŒ <a href="https://t.me/ChatGPTAdminWeb">ç¾¤ç»„</a> & <a href="https://t.me/ChatGPTAdminWebChannel">é¢‘é“</a>
        </td>
      </tr>
    </tbody>
  </table>
</div>

## ChatGPT Admin Web

<img src="./docs/system.svg" alt="system"/>

## ğŸ¤© å¼€å‘è®¡åˆ’

<img src="./docs/roadmap.svg" alt="system"/>

## ğŸš€ æŠ€æœ¯æ ˆ Tech Stack

<img src="./docs/tech-stack.svg" alt="tech-stack"/>

## ä»“åº“ Repository

è¿™æ˜¯ä¸€ä¸ª monorepo ä»“åº“ï¼Œç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š

| Package           | Package Description | Package Version | License    |
|-------------------|---------------------|-----------------|------------|
| apps/chat         | ç”¨æˆ·ç•Œé¢                | 0.0.1           | 996 && MIT |
| apps/dash         | åå°ç®¡ç†                | 0.0.1           | MIT        |
| apps/docs         | é¡¹ç›®æ–‡æ¡£                | 0.0.1           | MIT        |
| packages/bots     | API æ¥å£å’Œè‡ªå®šä¹‰æ¨¡å‹æ¥å£      | 0.0.1           | MIT        |
| packages/database | æ•°æ®åº“ DAL ä»¥åŠéƒ¨åˆ† Logic  | 0.0.1           | MIT        |

## ä½œè€… Author

- [@AprilNEA](https://github.com/AprilNEA)
- [@PeronGH](https://github.com/PeronGH)

## â˜ï¸ è®¸å¯è¯ License

æœ¬ä»“åº“ä¸­ [apps/chat](./apps/chat) æ˜¯åŸºäºä»“åº“ [Yidadaa's repository](https://github.com/Yidadaa/ChatGPT-Next-Web) çš„
996è®¸å¯è¯ä»¥[MIT license](./LICENSE)çš„å½¢å¼ä»æ–°åˆ†å‘ã€‚

å…¶ä»–éƒ¨åˆ†å‡ä»¥[MIT license](./LICENSE)åˆ†å‘ã€‚

<img src="https://hits-app.vercel.app/hits?url=https%3A%2F%2Fgithub.com%2FAprilNEA%2FChatGPT-Admin-Web" />

# ä¿®æ”¹è€… simonkorl çš„è¯

è¿™æ˜¯ä¸€ä¸ªä¸ªäººé­”æ”¹ç‰ˆæœ¬ï¼Œæ–°åˆ›å»ºäº†ä¸€ä¸ªåä¸º edu çš„ chatbotï¼Œå¯ä»¥ç”¨æ¥å¯¹æ¥ä¸åŒçš„ API

## æœ¬åœ°æµ‹è¯•ä¸éƒ¨ç½²

æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤ä¾æ¬¡æ‰§è¡Œ

### 1. å®‰è£…ç¯å¢ƒä¾èµ–

#### 1.1 nodejs

è¿™å°æœºå™¨ä¸Šä½¿ç”¨çš„ç¯å¢ƒæ˜¯ node v20.6.1 ï¼Œç†è®ºä¸Šæ¯”è¿™ä¸ªç‰ˆæœ¬é«˜åº”è¯¥éƒ½ä¸ä¼šå‡ºç°é—®é¢˜ã€‚

å¦‚æœæƒ³åœ¨ ubuntu20.04 ä¸Šé¢ä»¥æœ€å°çš„åŠ›æ°”å®‰è£…æœ€æ–°çš„ nodejs çš„è¯ï¼Œæˆ‘å»ºè®®æŒ‰ç…§ https://github.com/nodesource/distributions#ubuntu-versions ä¸­çš„å®‰è£…æ­¥éª¤ï¼Œä¸€æ­¥ä¸€æ­¥è·Ÿéšæ‰§è¡Œå³å¯ã€‚æ³¨æ„å…ˆå¸è½½ä¹‹å‰å®‰è£…è¿‡çš„ nodejsã€‚

#### 1.2 pnpm

`npm intall pnpm -g`

### 2. è¯•è¿è¡Œ

åœ¨å®Œæˆäº†ä¸Šé¢çš„ç¯å¢ƒå®‰è£…åï¼Œå°è¯•æ‰§è¡Œ`pnpm install` å’Œ `npm run dev` å‘½ä»¤ï¼Œå¦‚æœå¯ä»¥æˆåŠŸå®‰è£…åˆ™è¯´æ˜ç¯å¢ƒé…ç½®æ­£ç¡®ã€‚

åœ¨è¿è¡Œä¹‹åï¼Œvscode ä¼šè‡ªåŠ¨å¼¹å‡º doc ç•Œé¢ï¼Œå»ºè®®å…ˆä»å‰å¾€åçœ‹ä¸€éï¼Œå¯¹é¡¹ç›®æ•´ä½“æœ‰ä¸€ä¸ªäº†è§£ã€‚

### 3. å‡†å¤‡ redis æ•°æ®åº“

å¦‚æœæƒ³è¦å°½å¿«éƒ¨ç½²æµ‹è¯•ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨ upstash çš„æ•°æ®åº“ã€‚æœªæ¥å¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥æƒ³åŠæ³•è¿ç§»åˆ°è‡ªå·±æ‰€æœ‰çš„ redis æ•°æ®åº“ã€‚

å‚è€ƒ [](apps/docs/docs/02-quick-deploy.md) ä¸­çš„æ•™ç¨‹è¿›è¡Œæ³¨å†Œå’Œé…ç½®ã€‚

ä¸ºäº†ä½¿ä½ çš„æ•°æ®åº“ç”Ÿæ•ˆï¼Œä½ éœ€è¦åœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€ä¸ªæ¯ä¸ª plan çš„ä½¿ç”¨ä¸Šé™è¡¨ã€‚ä½ éœ€è¦ç½‘æ•°æ®åº“æ’å…¥ json æ ¼å¼çš„æ–‡ä»¶æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬æŠŠç›¸å…³çš„åŠŸèƒ½å®ç°åœ¨ upstash_utils.py ä¸­ï¼Œè¯·å‚è€ƒä»£ç è¿›è¡Œä½¿ç”¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¤§æ¦‚çš„æ­¥éª¤æ¼”ç¤ºï¼š

- å®‰è£…ä¾èµ–ï¼š`pip install "redis[hiredis]"`
- åˆ›å»ºä¸€ä¸ªåä¸º `.redis.json` æ–‡ä»¶ï¼Œå…¶ä¸­çš„å†…å®¹åŒ…æ‹¬ upstash è¿›å…¥æ•°æ®åº“åçš„ Detailsï¼Œé€‰æ‹© python ä¹‹åçš„æ‰€æœ‰å…³é”®å­—ã€‚æ ¼å¼ç±»ä¼¼ä¸‹é¢çš„ä»‹ç»
  ```json
  {
    "host": "xxxxx.upstash.io",
    "port": 12345,
    "password":"xxxxxxx",
    "ssl": true
  }
  ```
- è¿è¡Œ python upstash_utils.py init åˆå§‹åŒ–æ•°æ®åº“

å¦‚æœå‡ºç° ssl çš„é”™è¯¯åˆ™è¯·æ³¨æ„ä½ çš„ upstash æ•°æ®åº“æ˜¯å¦å¯ç”¨äº† SSL éªŒè¯ï¼Œå¯ä»¥åœ¨ Details çš„ TLS/SSL ä¸€åˆ—ä¸­çœ‹åˆ°æ˜¯ enable è¿˜æ˜¯ disableã€‚å¦‚æœæ˜¯ disable åˆ™æŠŠç•Œé¢æ‹‰åˆ°æœ€åº•ä¸‹çš„ Configuration éƒ¨åˆ†ï¼Œç„¶åå°±å¯ä»¥å¯åŠ¨ TLS(SSL)ã€‚

### 4. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ apps/chat ç›®å½•ä¸‹ç¼–å†™ .env.local æ–‡ä»¶æ¥é…ç½®ç¯å¢ƒå˜é‡ï¼ˆè¿™æ ·ç›¸å¯¹æ¥è¯´æ›´åŠ ç¨³å®šè€Œä¸”å®‰å…¨ï¼‰ã€‚éœ€è¦æä¾›è‡³å°‘ä»¥ä¸‹çš„ä¿¡æ¯ï¼š

- `REDIS_URL=https://xxxxx.upstash.io`: ä½ åˆ›å»ºçš„ upstash æ•°æ®åº“
- `REDIS_TOKEN=xxxxx`: ä½ åˆ›å»ºçš„ upstash æ•°æ®åº“è®¿é—® token
- `JWT_SECRET=xxxx`: æ ¹æ®[æ–‡æ¡£](apps/docs/docs/02-quick-deploy.md)çš„è¯´æ˜ï¼Œç”Ÿæˆä¸€ä¸ªè¶³å¤Ÿé•¿çš„éšæœºå­—ç¬¦ä¸²

å»ºè®®æä¾›ä¸‹é¢æåˆ°çš„å˜é‡çš„æ•°å€¼
- `OPENAI_ENDPOINT`: å¦‚æœè¦ä½¿ç”¨ chatgptï¼Œé‚£ä¹ˆæœ€å¥½åœ¨æ— æ³•è®¿é—®åˆ° chat.openai.com çš„åœ°åŒºæä¾›ä¸€ä¸ªç½‘å€æ¥ä½œä¸º endpoint
- `OPENAI_API_KEY`: è®¾ç½®ä¹‹åå°±å¯ä»¥ä½¿ç”¨é»˜è®¤çš„ GPT-3.5 åŠŸèƒ½ï¼ˆä¸è¿‡åœ¨è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç ä¸‹éœ€è¦è¿›è¡Œä¸€äº›æ‰‹åŠ¨è®¾ç½®æ‰èƒ½ä½¿ç”¨ï¼‰
- `NEXT_PUBLIC_TITLE`: è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥æ”¹å˜ä¸»é¡µé¢ä¸Šçš„æ ‡é¢˜

æ³¨ï¼šè¯·ä¸è¦åœ¨ .env.local æ–‡ä»¶ä¸­å†™æ³¨é‡Šï¼è¿™ä¼šå¯¼è‡´é—®é¢˜ã€‚

### 5. æµ‹è¯•è¿è¡Œå’Œç™»å½•

è¿è¡Œ `npm run dev` å¯åŠ¨é¡¹ç›®ï¼Œè¿›å…¥ 3000 ç«¯å£å¯¹åº”çš„é¡µé¢ï¼Œç‚¹å‡»æ³¨å†Œã€‚éšä¾¿è¾“å…¥é‚®ç®±å’Œå¯†ç ï¼Œåº”è¯¥å¯ä»¥è¿›è¡Œæ³¨å†Œï¼Œå¹¶ä¸”ç™»å½•è¿›å…¥ chat é¡µé¢ã€‚æ­¤æ—¶æ— è®ºåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä»€ä¹ˆå†…å®¹ï¼Œå‘é€ååº”è¯¥éƒ½ä¸ä¼šäº§ç”Ÿä½œç”¨ã€‚

### 6. å¯åŠ¨ langchain-chatglm

è¿›å…¥ä¿®æ”¹åçš„ langchain-chatglm é¡¹ç›®ï¼Œè¿è¡Œ `pip install -r requirements.txt` å®‰è£…ä¾èµ–ï¼Œå¹¶ä¸”ä½¿ç”¨ `python api.py` å¯åŠ¨ç¨‹åºã€‚è¿™ä¼šå¯åŠ¨å¤§æ¨¡å‹è¿›è¡Œé—®ç­”ï¼Œè¯·æ³¨æ„æœ¬æœºçš„èµ„æºæƒ…å†µï¼Œå»ºè®®åœ¨å‘½ä»¤å‰é¢åŠ ä¸Š `CUDA_VISIBLE_DEVICES=0` ç­‰å˜é‡è®¾ç½®æ¥é™åˆ¶æ˜¾å¡çš„ä½¿ç”¨ã€‚

### 7. æµ‹è¯• edubot å¯¹è¯

å¯åŠ¨ api.py ä¹‹åï¼Œç­‰å¾…å‘½ä»¤è¡Œè¾“å‡ºç»¿è‰²çš„å¯åŠ¨æ–‡å­—ä¹‹åï¼Œåœ¨å¯¹è¯ä¸»ç•Œé¢çš„å¯¹è¯æ¡†ä¸­è¾“å…¥æ–‡å­—å¹¶ä¸”æäº¤ã€‚ä¸€æ®µæ—¶é—´ååº”è¯¥å¯ä»¥çœ‹åˆ°å¯¹è¯å†…å®¹ã€‚

## å…¶ä»–è¯´æ˜

### å¯¹è¯æœºå™¨äººä¸å¦‚ä½•ä¿®æ”¹

ä»£ç ä¸­çš„å¯¹è¯æœºå™¨äººåŸºæœ¬ä¸Šéƒ½å¯ä»¥åœ¨ packages/bots/src å½“ä¸­æ‰¾åˆ°ï¼Œç±»ä¼¼äº openai.ts, bing.ts è¿™æ ·ã€‚

æˆ‘ä»¬çš„è¿™ä¸ªé¡¹ç›®é¢å¤–æ·»åŠ äº† edu.ts å’Œ glm.ts ä¸¤ä¸ªå¯¹è¯æœºå™¨äººï¼Œå¯ä»¥ä»æœ¬åœ°çš„ 7861 ç«¯å£çš„å¯¹åº” url è·å–æ•°æ®ã€‚

ç›®å‰çš„è®¾è®¡æ˜¯è¿™æ ·ï¼š

- edu.ts

ç¼–å†™äº† EduBotï¼Œç”¨äºé«˜è€ƒå’¨è¯¢ï¼Œè¯»å– http://localhost:7861/test è¿›è¡Œ langchain+chatglm çš„å¯¹è¯ã€‚éœ€è¦äº‹å…ˆå‡†å¤‡å¥½å’¨è¯¢ä½¿ç”¨çš„æ–‡æœ¬ï¼Œå¹¶ä¸”æ”¾ç½®åœ¨ langchain-chatglm çš„å¯¹åº”ç›®å½•ï¼Œå¹¶ä¸”è¿è¡Œ python api.py æ‰èƒ½ä½¿ç”¨ã€‚

- glm.ts

è¿™ä¸ªæ–‡ä»¶ä¸­åŒ…æ‹¬äº† GLMBotï¼Œä½†æ˜¯è¿™ä¸ª bot å¹¶ä¸èƒ½ä½¿ç”¨ chatglm è¿›è¡Œå›å¤ï¼ˆç›®å‰ä¸è¡Œï¼‰ï¼Œå®ƒå”¯ä¸€çš„åŠŸèƒ½æ˜¯ä¸ hack æ¨¡å¼è¿›è¡Œåä½œï¼Œè¯»å–æŸä¸ªæ–‡ä»¶ä¸­çš„å›ºå®šç­”æ¡ˆå¹¶ä¸”è¿›è¡Œå›å¤ã€‚

- hack æ¨¡å¼

ä¸¤ä¸ª chatbot éƒ½å¯ä»¥ä½¿ç”¨ä¸€ç§ hack æ¨¡å¼ï¼Œåœ°å€ä¸º http://localhost:7861/hack ã€‚è¿™ç§ hack æ¨¡å¼å¯ä»¥ä» langchain çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹è¯»å–ä¸€ä¸ª json æ–‡ä»¶ï¼Œå¹¶ä¸”ä»¥æ–‡ä»¶çš„å†…å®¹è¿›è¡Œå›ç­”ã€‚è¿™ä¸ªåŠŸèƒ½å®ç°åœ¨ langchain-chatglm::api.py::hack_streamer å‡½æ•°ä¸­ã€‚ä½ å¯ä»¥æä¾›ä»¥ä¸‹æ ¼å¼çš„ json æ ¼å¼æ–‡ä»¶æ¥å¾—åˆ°é—®ç­”ä¿¡æ¯ï¼š

```json
[
  {
    "answer": "", // è¦å›ç­”çš„å†…å®¹ï¼Œæ¯ä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—å…¸å¹¶ä¸”è¿”å› dict['answer']
  },
  ...
]
```

å…¶ä¸­ï¼Œedubot è¯»å–çš„æ˜¯ langchain-Chatglm/results/gaokao_result/langchain_result_new.json, glmbot è¯»å–çš„æ˜¯ langchain-Chatglm/glm_history.json ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶è·¯å¾„æ˜¯å†™æ­»åœ¨ api.py::hack_streamer å½“ä¸­çš„ï¼Œéœ€è¦çš„è¯å¯ä»¥ä¿®æ”¹ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶é‚£ä¹ˆä½¿ç”¨ api çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚

å¦‚æœä½ å¸Œæœ›ä¿®æ”¹ç°æœ‰çš„ chatbotï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ packages/bots/src ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ã€‚

å¦‚æœä½ å¸Œæœ›æ·»åŠ ã€å‡å°‘ã€ä¿®æ”¹å½“å‰å¯ä»¥ä½¿ç”¨çš„ chatbotï¼Œé‚£ä¹ˆä½ éœ€è¦ä¿®æ”¹ä¸å°‘å†…å®¹ï¼Œä¸‹é¢æœ‰ä¸€äº›æç¤ºï¼š

- åœ¨ packages/bots/src ä¸­ç¼–å†™ä½ éœ€è¦åŠŸèƒ½çš„ chatbotï¼Œå¯ä»¥å‚è€ƒ openai.ts ä¸­çš„æ ¼å¼ç¼–å†™
- åœ¨ `apps/chat/src/app/api/bots/typing.ts` ä¸­çš„ otherModel ä¸­æ·»åŠ ä½ ç¼–å†™çš„å…¨æ–° modelï¼Œå¦åˆ™æ— æ³•æäº¤ post ä¿¡æ¯

```ts
const chatRole = z.enum(["assistant", "system", "user"]);
export const gptModel = z.enum(["gpt-3.5-turbo", "gpt-4"]);
const otherModel = z.enum(["new-bing", "edu", "glm"]);
```

- åœ¨ `apps/chat/src/app/api/bots/[model]/route.ts` ä¸­çš„ switch è¯­å¥ä¸­ç¼–å†™ä½ ç¼–å†™çš„ chatbot å¯¹è±¡ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨

```ts
switch (params.model) {
    case "openai":
      const validatedModel = gptModel.parse(model);
      bot = new OpenAIBot(OPENAI_API_KEY, validatedModel);
      break;
    case "new-bing":
      bot = new BingBot(BING_COOKIE);
      break;
    case "edu":
      bot = new EduBot();
      break;
    case "glm":
      bot = new GlmBot();
      break;
    default:
      return NextResponse.json(
        { msg: "unable to find model" },
        { status: 404 }
      );
  }
```

- åœ¨ `apps/chat/src/store/setting/typing.ts` ä¿®æ”¹ç¬¬ä¸€è¡Œçš„ Model typeï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è®¾å®šå½“ä¸­è¿›è¡Œæ¨¡å‹åˆ‡æ¢

```ts
export type Model = "gpt-3.5-turbo" | "gpt-4" | "newbing" | "edu" | "glm";
```

- åœ¨ `apps/chat/src/store/chat/index.ts` ä¸­ä¿®æ”¹ ALL_MODEL å˜é‡ï¼Œä»è€Œæ”¹å˜ setting é¡µé¢å¯ä¾›é€‰æ‹©çš„æ¨¡å‹

```ts
export const ALL_MODELS = [
  // {
  //   name: "gpt-4",
  //   available: true,
  // },
  // {
  //   name: "gpt-3.5-turbo",
  //   available: true,
  // },
  // {
  //   name: "newbing",
  //   available: true,
  // },
  {
    name: "edu",
    available: true,
  },
  {
    name: 'glm',
    available: true
  }
];
```

- åœ¨ `apps/chat/src/store/setting/index.ts` ä¸­ä¿®æ”¹è®¾å®šçš„é»˜è®¤å€¼ï¼Œä¸»è¦éœ€è¦ä¿®æ”¹ model å­—æ®µä»¥è®¾å®šé»˜è®¤ model

```ts
/***
 * é»˜è®¤è®¾ç½®, ç”¨äºåˆå§‹åŒ–ä»¥åŠé‡ç½®
 */
const DEFAULT_CONFIG: ChatConfig = {
  historyMessageCount: 8,
  compressMessageLengthThreshold: 1000,
  sendBotMessages: true as boolean,
  submitKey: SubmitKey.Enter as SubmitKey,
  avatar: "1f603",
  theme: Theme.Auto as Theme,
  tightBorder: true,

  modelConfig: {
    // model: "gpt-3.5-turbo",
    model: "edu",
    temperature: 0.7,
    max_tokens: 2000,
    presence_penalty: 0,
  },
};
```

- ä¿®æ”¹ `apps/chat/src/utils/requests.ts` ä¸­çš„ makeRequestParam å˜é‡

### TODO: ç”¨æˆ·ç±»å‹ä¸æƒé™ä¿®æ”¹æ–¹å¼

### é¡¹ç›®çš„å¥‡å¦™å°åŠŸèƒ½

- å¯¹è¯é™é¢ï¼šå¯¹è¯åœ¨ä¸€å®šæ—¶é—´å†…æ¬¡æ•°è¿‡å¤šä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨æŸä¸ªæ¨¡å‹ã€‚æ³¨ï¼šç›®å‰è¿™ä¸ªåŠŸèƒ½åœ¨å±å¹•çš„å·¦ä¸‹è§’æ˜¾ç¤ºçš„ä½™é‡æ˜¯é”™è¯¯çš„ï¼
- å¼¹å‡ºå¼å¹¿å‘Šï¼šå¦‚æœè¾“å…¥çš„é—®é¢˜ä¸­åŒ…æ‹¬[ä¸­ä»‹ã€ç•™å­¦ã€æ–‡ä¹¦]å…¶ä¸­ä¸€ä¸ªè¯ï¼Œå¹¶ä¸”æ˜¯å…è´¹ç”¨æˆ·çš„è¯ï¼Œå°±ä¼šå¼¹å‡ºå¹¿å‘Š
- ç›®å‰æ²¡æœ‰é€€å‡ºç™»å½•çš„é€‰é¡¹ï¼Œå¿…é¡»è¦æ‰‹åŠ¨æ¸…æ¥šæµè§ˆå™¨çš„ç¼“å­˜ cookieï¼Œè¿™ä¼šå¯¼è‡´ä¹‹å‰çš„å¯¹è¯ä¿¡æ¯å…¨éƒ¨æ¶ˆå¤±
- å¦‚æœå¯¹è¯çš„è®ºè¿°è¶…å‡ºäº†è®¾å®šï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨ openai è¿›è¡Œ summerizeï¼Œç›®å‰å–æ¶ˆäº†è¿™ä¸ªåŠŸèƒ½ apps/chat/src/store/chat/index.ts, apps/chat/src/utils/requests.ts, 
```ts
// add memory prompt
        toBeSummarizedMsgs.unshift(get().getMemoryPrompt());

        const lastSummarizeIndex = session.messages.length;

        console.log(
          "[Chat History] ",
          toBeSummarizedMsgs,
          historyMsgLength,
          config.compressMessageLengthThreshold
        );

        if (historyMsgLength > config.compressMessageLengthThreshold) {
          requestChatStream(
            toBeSummarizedMsgs.concat({
              role: "system",
              content: Locale.Store.Prompt.Summarize,
              date: "",
            }),
            {
              filterBot: false,
              onMessage(message, done) {
                session.memoryPrompt = message;
                if (done) {
                  console.log("[Memory] ", session.memoryPrompt);
                  session.lastSummarizeIndex = lastSummarizeIndex;
                }
              },
              onBlock() {
                session.memoryPrompt = "ä½ å¥½, è¯·é—®ä½ å¯ä»¥å¸®æˆ‘è§£å†³ä»€ä¹ˆ";
              },
              onError(error) {
                console.error("[Summarize] ", error);
              },
            }
          );
        }


        switch(options?.modelConfig?.model) {
      case "newbing":
        api = "/api/bots/newbing"
        break;
      case "edu":
        api = "/api/bots/edu"
        break;
      case "glm":
        api = "/api/bots/glm"
        break;
      case "gpt-3.5-turbo":
      case "gpt-4":
        api = "/api/bots/openai"
        break;
      case undefined: {
        // æ­¤æ—¶å¯¹è¯æ¬¡æ•°è¿‡å¤šï¼Œç½‘é¡µä¼šè¯·æ±‚æ€»ç»“å¯¹è¯å†…å®¹
        // è¿™ä¸ªæ—¶å€™éœ€è¦ä½¿ç”¨å¤§æ¨¡å‹æ€»ç»“ï¼Œç›®å‰ä¸æ”¯æŒè¿™ä¸ªåŠŸèƒ½
        console.log("Disable Summarization");
        let responseText = "è®°å¿†åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨";
        const finish = () => {
          options?.onMessage(responseText, true);
          controller.abort();
        };
        options?.onBlock();
        return finish();
      }
      default:
        break;
    }
```
- åœ¨å¯¹è¯çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿæ€»ç»“ apps/chat/src/store/chat/index.ts
```ts
if (session.topic === DEFAULT_TOPIC && session.messages.length >= 3) {
          // should summarize topic
          // requestWithPrompt(session.messages, Locale.Store.Prompt.Topic).then( (res) => {
          //     get().updateCurrentSession(
          //       (session) => (session.topic = trimTopic(res))
          //     );
          //   }
          // );
          get().updateCurrentSession(
             (session) => (session.topic = trimTopic("æš‚æ—¶ä¸æ”¯æŒä¸Šä¸‹æ–‡æ€»ç»“åŠŸèƒ½ï¼Œè¯·è€å¿ƒç­‰å€™"))
          );
        }
```